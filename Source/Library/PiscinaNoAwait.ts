export const { dirname, resolve } = await import("node:path");

export const { default: Piscina } = await import("piscina");

export const File = (await import("node:url")).fileURLToPath(import.meta.url);

export const Calculation = new Piscina({
	filename: resolve(`${dirname(File)}/../../Target/test/calculation.js`),
	concurrentTasksPerWorker: 10.0,
});

export const _Function = new Piscina({
	filename: resolve(`${dirname(File)}/../../Target/test/function-call.js`),
	concurrentTasksPerWorker: 10.0,
});

await Promise.all([
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
	Calculation.run({}),
	_Function.run({}),
]);
